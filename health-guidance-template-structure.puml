@startuml 健康指导模板详细结构图

skinparam backgroundColor #FAFAFA
skinparam class {
    BackgroundColor #FFFFFF
    BorderColor #CCCCCC
    FontColor #333333
    ArrowColor #666666
}
skinparam note {
    BackgroundColor #FFFACD
    BorderColor #DDD
}

title 健康指导模板 - 详细结构图

' 健康指导模板主类
class 健康指导模板 {
    - templateId: String // 模板唯一标识
    - templateName: String // 模板名称
    - description: String // 模板描述
    - category: String // 适用分类(糖尿病、高血压等)
    - isActive: Boolean // 是否启用
    - createdTime: DateTime // 创建时间
    - updatedTime: DateTime // 更新时间
    - usageCount: Integer // 使用次数统计
    - createdBy: String // 创建者ID
    --
    + createTemplate(): void // 创建新模板
    + updateTemplate(): void // 更新模板信息
    + deleteTemplate(): void // 删除模板
    + exportToExcel(): void // 导出为Excel文件
    + importFromExcel(): void // 从Excel导入
    + incrementUsageCount(): void // 增加使用次数
}

' 建议配置容器类
class 建议配置容器 {
    - templateId: String // 所属模板ID
    - textSuggestions: List<文本建议> // 文本建议列表
    - multipleGroups: Map<String, 多选建议组> // 多选建议组映射
    - singleGroups: Map<String, 单选建议组> // 单选建议组映射
    - numericSettings: Map<String, 数值参数设置> // 数值参数映射
    --
    + getAllSuggestions(): Map<String, Object> // 获取所有建议配置
    + validateConfiguration(): Boolean // 验证配置有效性
    + generatePreview(): String // 生成预览内容
}

' 文本建议类
class 文本建议 {
    - suggestionId: String // 建议唯一标识
    - content: String // 建议文本内容
    - defaultSelected: Boolean // 是否默认选中
    - sortOrder: Integer // 显示排序
    --
    + getText(): String // 获取建议文本
    + isDefaultSelected(): Boolean // 检查是否默认选中
    + setSortOrder(order: Integer): void // 设置排序顺序
}

' 多选建议组类
class 多选建议组 {
    - groupId: String // 建议组唯一标识
    - title: String // 建议组标题
    - options: List<多选建议选项> // 选项列表
    - minSelection: Integer // 最少选择数量
    - maxSelection: Integer // 最多选择数量
    - sortOrder: Integer // 显示排序
    --
    + addOption(option: 多选建议选项): void // 添加选项
    + removeOption(optionId: String): void // 删除选项
    + validateSelection(selectedIds: List<String>): Boolean // 验证选择有效性
    + getDefaultSelections(): List<String> // 获取默认选中项
}

' 多选建议选项类
class 多选建议选项 {
    - optionId: String // 选项唯一标识
    - content: String // 选项内容
    - defaultSelected: Boolean // 是否默认选中
    - sortOrder: Integer // 显示排序
    --
    + getContent(): String // 获取选项内容
    + isDefaultSelected(): Boolean // 检查是否默认选中
}

' 单选建议组类
class 单选建议组 {
    - groupId: String // 建议组唯一标识
    - title: String // 建议组标题
    - options: List<单选建议选项> // 选项列表
    - defaultSelected: String // 默认选中的选项ID
    - sortOrder: Integer // 显示排序
    --
    + addOption(option: 单选建议选项): void // 添加选项
    + removeOption(optionId: String): void // 删除选项
    + setDefaultSelection(optionId: String): void // 设置默认选中项
    + getDefaultSelection(): String // 获取默认选中项
}

' 单选建议选项类
class 单选建议选项 {
    - optionId: String // 选项唯一标识
    - content: String // 选项内容
    - sortOrder: Integer // 显示排序
    --
    + getContent(): String // 获取选项内容
}

' 数值参数设置类
class 数值参数设置 {
    - parameterId: String // 参数唯一标识
    - title: String // 参数标题
    - unit: String // 数值单位(如kcal、%、次等)
    - defaultValue: Number // 默认数值
    - defaultSelected: Boolean // 是否默认选中
    - minValue: Number // 最小值限制
    - maxValue: Number // 最大值限制
    - step: Number // 调整步长
    - sortOrder: Integer // 显示排序
    --
    + validateValue(value: Number): Boolean // 验证数值有效性
    + getFormattedValue(value: Number): String // 格式化显示数值
    + adjustValue(value: Number, direction: String): Number // 按步长调整数值
}

' 模板使用记录类
class 模板使用记录 {
    - recordId: String // 使用记录唯一标识
    - templateId: String // 使用的模板ID
    - doctorId: String // 使用的医生ID
    - patientId: String // 目标患者ID
    - usageTime: DateTime // 使用时间
    - selectedSuggestions: Map<String, Object> // 选中的建议项目
    - customContent: String // 医生自定义内容
    --
    + recordUsage(): void // 记录使用情况
    + getUsageStatistics(): Map<String, Integer> // 获取使用统计
}

' 模板分类枚举
enum 模板分类 {
    CORONARY_HEART_DISEASE("冠心病")
    HYPERTENSION("高血压")
    HEART_FAILURE("心脏病")
    DIABETES("糖尿病")
    HYPERURICEMIA("高尿酸血症")
    HYPERGLYCEMIA("高血糖")
    HYPERLIPIDEMIA("高血脂")
    MYOCARDITIS("心肌炎")
    GENERAL("通用")
}

' 建议类型枚举
enum 建议类型 {
    TEXT("文本建议")
    MULTIPLE("多选建议")
    SINGLE("单选建议")
    NUMERIC("数值参数")
}

' 类之间的关系

' 健康指导模板与建议配置容器的组合关系
健康指导模板 ||--|| 建议配置容器 : 包含

' 建议配置容器与各种建议类型的组合关系
建议配置容器 ||--o{ 文本建议 : 包含
建议配置容器 ||--o{ 多选建议组 : 包含
建议配置容器 ||--o{ 单选建议组 : 包含
建议配置容器 ||--o{ 数值参数设置 : 包含

' 多选建议组与选项的组合关系
多选建议组 ||--o{ 多选建议选项 : 包含

' 单选建议组与选项的组合关系
单选建议组 ||--o{ 单选建议选项 : 包含

' 健康指导模板与使用记录的关联关系
健康指导模板 ||--o{ 模板使用记录 : 记录使用

' 枚举关系
健康指导模板 }o--|| 模板分类 : 属于
建议配置容器 }o--|| 建议类型 : 包含

' 添加详细注释
note top of 健康指导模板 : 模板主体，包含基本信息\n和使用统计，支持导入导出功能

note top of 建议配置容器 : 模板的核心配置部分\n管理四种类型的建议项目

note right of 文本建议 : 最简单的建议类型\n直接显示文本内容\n例如："减少碳水化合物摄入"

note right of 多选建议组 : 分组的多选建议\n例如："饮食控制方式（可多选）"\n包含多个可选择的选项

note right of 单选建议组 : 分组的单选建议\n例如："复诊频率（单选）"\n只能选择一个选项

note right of 数值参数设置 : 可配置数值的参数\n例如："每日热量摄入：1800kcal"\n支持范围限制和步长调整

note bottom of 模板使用记录 : 记录模板的使用情况\n用于统计分析和优化

note bottom of 模板分类 : 支持的疾病分类\n用于模板的分类管理

' 示例数据结构
note as ExampleData
<b>示例：糖尿病饮食指导模板</b>
--
<b>文本建议：</b>
• 减少碳水化合物摄入，控制每餐主食量
• 避免吸烟和饮酒，保持健康生活方式

<b>多选建议组：饮食控制方式</b>
• 每日盐摄入量控制在5g以下
• 避免精制糖和高糖水果
• 增加蔬菜和优质蛋白质比例

<b>单选建议组：复诊频率</b>
• 1个月后复诊（默认）
• 3个月后复诊
• 6个月后复诊

<b>数值参数：每日热量摄入</b>
• 默认值：1800kcal
• 范围：1200-2500kcal
• 步长：50kcal
end note

ExampleData .. 健康指导模板

@enduml