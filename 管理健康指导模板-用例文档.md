# 管理健康指导模板 - 用例文档

## 用例基本信息

| 项目 | 内容 |
|------|------|
| **用例名称** | 管理健康指导模板 |
| **简要描述** | 系统管理员通过管理后台创建、编辑、删除和维护健康指导模板，配置不同疾病分类的建议项目，支持模板的导入导出和使用统计分析，为医生提供标准化的健康指导内容框架 |
| **参与者** | 系统管理员（主要参与者） |
| **涉众** | 系统管理员、医生、患者、健康指导系统、模板管理系统 |
| **相关用例** | 发送健康指导、创建指导内容、模板使用统计、系统权限管理、数据导入导出 |

## 前置条件

• 系统管理员已完成身份认证，具有模板管理权限
• 模板管理系统正常运行，数据库连接正常
• 管理后台界面可正常访问，网络连接稳定
• 系统已初始化基础的疾病分类数据（糖尿病、高血压、心脏病等）
• 本地存储或数据库具有足够空间存储模板数据
• 浏览器支持现代Web标准，兼容JavaScript和CSS3功能

## 后置条件

• 健康指导模板成功创建、更新或删除，数据持久化保存
• 模板配置的建议项目完整保存，包括文本、多选、单选、数值等类型
• 医生端可以正常使用更新后的模板进行健康指导
• 系统记录模板的操作日志，包括创建、修改、删除等行为
• 模板使用统计数据实时更新，为系统优化提供数据支持
• 导入导出功能正常工作，支持模板的批量管理和备份

## 基本事件流

### 1. 管理员进入模板管理界面

1. **访问管理后台**
   - 管理员通过浏览器访问健康指导系统管理后台
   - 系统验证管理员身份和权限，确认具有模板管理权限
   - 系统显示管理后台主界面，包含模板管理入口

2. **进入模板管理页面**
   - 管理员点击"健康指导模板管理"菜单项
   - 系统跳转到模板管理页面（template-manager.html）
   - 页面显示顶部导航栏，包含返回按钮和页面标题
   - 系统采用响应式布局，适配不同屏幕尺寸

### 2. 模板列表展示和管理

1. **加载模板数据**
   - 系统从localStorage或数据库加载现有的健康指导模板
   - 如果是首次访问，系统加载默认模板数据作为示例
   - 系统按创建时间倒序排列模板列表

2. **模板列表界面展示**
   - 系统显示模板管理页面头部，包含"新建"和"导入"按钮
   - 提供搜索栏，支持按模板名称进行实时搜索
   - 以表格形式展示模板列表，包含以下列：
     * 序号：自动编号，便于快速定位
     * 模板名称：显示完整的模板名称
     * 适用分类：显示疾病分类（如糖尿病、高血压等）
     * 使用次数：显示模板被医生使用的统计次数
     * 创建时间：显示模板创建的日期时间
     * 更新时间：显示最后修改的日期时间
     * 操作：提供编辑、预览、删除等操作链接

3. **表格交互功能**
   - 表格行支持悬停效果，提升用户体验
   - 使用次数以蓝色高亮显示，可点击查看详细统计
   - 操作链接采用不同颜色区分：编辑（蓝色）、删除（红色）
   - 支持分页显示，每页默认显示10条记录

### 3. 创建新模板

1. **打开创建模板弹窗**
   - 管理员点击页面头部的"新建"按钮
   - 系统弹出模板创建模态框，标题显示"新建模板"
   - 模态框采用居中显示，背景半透明遮罩
   - 支持点击背景或关闭按钮关闭模态框

2. **填写模板基本信息**
   - **模板名称**：必填字段，输入框带有红色星号标识
     * 支持中文、英文、数字和常用符号
     * 长度限制为2-50个字符
     * 系统实时验证名称唯一性
   
   - **模板描述**：可选字段，多行文本输入框
     * 支持详细描述模板的用途和适用场景
     * 长度限制为500个字符以内
     * 支持换行和基本格式
   
   - **适用分类**：下拉选择框
     * 提供预设的疾病分类选项：冠心病、高血压、心脏病、糖尿病、高尿酸血症、高血糖、高血脂、心肌炎
     * 支持选择"通用"分类，适用于多种疾病
     * 可以留空表示通用模板

### 4. 配置建议项目

模板的核心功能是配置各种类型的建议项目，系统提供四种建议类型的配置界面：

#### 4.1 建议项目编辑器界面

1. **标签页导航设计**
   - 建议项目配置区域采用标签页设计，包含四个标签：
     * 文本建议：用于配置纯文本类型的健康建议
     * 多选建议：用于配置可多选的建议选项组
     * 单选建议：用于配置单选的建议选项组
     * 数值设置：用于配置数值类型的参数设置
   
   - 标签页采用卡片式设计，活跃标签高亮显示
   - 每个标签页内容独立，支持单独配置和保存

2. **通用操作界面**
   - 每个标签页顶部显示当前建议类型的说明
   - 提供"添加建议"按钮，支持快速添加新的建议项
   - 建议列表支持滚动查看，最大高度300px
   - 空状态时显示友好的提示信息和引导

#### 4.2 文本建议配置

1. **文本建议项目结构**
   - 每个文本建议包含以下属性：
     * 建议内容：具体的健康指导文本
     * 默认选中状态：是否在医生使用时默认选中
     * 唯一标识：系统自动生成，用于数据管理

2. **文本建议编辑界面**
   - 建议内容输入框：支持多行文本输入，最大长度200字符
   - 默认选中复选框：控制该建议是否默认被选中
   - 操作按钮：编辑、删除按钮，支持快速修改和移除
   - 拖拽排序：支持通过拖拽调整建议的显示顺序

3. **文本建议示例**
   ```
   建议内容：减少碳水化合物摄入，控制每餐主食量
   默认选中：是
   
   建议内容：避免吸烟和饮酒，保持健康生活方式
   默认选中：否
   ```

#### 4.3 多选建议配置

1. **多选建议组结构**
   - 每个多选建议组包含：
     * 组名称：建议组的标题（如"饮食建议"）
     * 选项列表：该组内的多个可选项
     * 最小选择数：至少需要选择的选项数量
     * 最大选择数：最多可以选择的选项数量

2. **多选建议编辑界面**
   - 组名称输入框：设置建议组的标题
   - 选项管理区域：
     * 选项内容输入框：输入具体的选项文本
     * 添加选项按钮：支持动态添加新选项
     * 删除选项按钮：移除不需要的选项
   - 选择数量限制：设置最小和最大选择数量
   - 选项排序：支持拖拽调整选项顺序

#### 4.4 单选建议配置

1. **单选建议组结构**
   - 每个单选建议组包含：
     * 组名称：建议组的标题
     * 选项列表：该组内的单选选项
     * 默认选项：预设的默认选中选项

2. **单选建议编辑界面**
   - 组名称输入框：设置建议组标题
   - 选项管理：
     * 选项内容输入：输入选项的具体文本
     * 默认选项标记：设置哪个选项为默认选中
     * 选项操作：编辑、删除、排序功能
   - 选项预览：实时显示单选组的效果

#### 4.5 数值设置配置

1. **数值设置项结构**
   - 每个数值设置包含：
     * 参数名称：数值参数的名称（如"目标血糖值"）
     * 数值类型：整数、小数、范围等
     * 默认值：预设的数值
     * 单位：数值的计量单位
     * 取值范围：最小值和最大值限制

2. **数值设置编辑界面**
   - 参数名称输入框：设置数值参数的名称
   - 数值类型选择：整数、小数、范围选择
   - 默认值设置：输入预设的数值
   - 单位输入框：设置计量单位（如mg/dl、mmol/L等）
   - 范围限制：设置最小值和最大值
   - 步长设置：设置数值调整的步长

### 5. 模板保存和验证

1. **数据验证**
   - 系统验证模板名称的唯一性和格式要求
   - 检查必填字段是否完整填写
   - 验证建议项目的配置是否合理
   - 检查数值设置的范围和默认值是否有效

2. **保存操作**
   - 管理员点击"保存"按钮提交模板数据
   - 系统生成唯一的模板ID和时间戳
   - 将模板数据保存到localStorage或数据库
   - 更新模板列表显示，新模板出现在列表顶部

3. **保存反馈**
   - 保存成功后显示成功提示信息
   - 自动关闭模态框，返回模板列表页面
   - 新创建的模板在列表中高亮显示
   - 更新页面统计信息（总模板数等）

### 6. 模板编辑和更新

1. **打开编辑模式**
   - 管理员在模板列表中点击"编辑"链接
   - 系统打开模板编辑模态框，标题显示"编辑模板"
   - 模态框预填充现有的模板数据
   - 所有配置项显示当前的设置值

2. **修改模板内容**
   - 管理员可以修改模板的基本信息
   - 可以添加、编辑、删除建议项目
   - 支持调整建议项目的顺序和配置
   - 修改过程中实时保存草稿状态

3. **更新保存**
   - 点击保存按钮更新模板数据
   - 系统更新模板的修改时间戳
   - 保持模板ID不变，确保引用关系正确
   - 更新成功后刷新列表显示

### 7. 模板预览功能

1. **打开预览模式**
   - 管理员点击模板列表中的"预览"链接
   - 系统打开模板预览模态框
   - 预览界面模拟医生使用模板的效果
   - 显示所有配置的建议项目

2. **预览内容展示**
   - 按照实际使用顺序展示建议项目
   - 文本建议显示为可选择的文本块
   - 多选和单选建议显示为选项组
   - 数值设置显示为输入控件
   - 整体布局与医生端使用界面一致

3. **预览交互**
   - 支持在预览中测试选择和输入功能
   - 可以查看默认选中状态的效果
   - 验证建议项目的逻辑关系
   - 提供导出预览内容的功能

### 8. 模板删除管理

1. **删除确认**
   - 管理员点击模板列表中的"删除"链接
   - 系统弹出删除确认对话框
   - 显示模板名称和使用次数信息
   - 警告删除操作不可恢复

2. **删除执行**
   - 管理员确认删除后，系统执行删除操作
   - 从数据存储中移除模板数据
   - 更新模板列表显示
   - 显示删除成功的提示信息

### 9. 模板搜索和筛选

1. **实时搜索功能**
   - 管理员在搜索框中输入关键词
   - 系统实时过滤模板列表
   - 支持按模板名称进行模糊匹配
   - 搜索结果高亮显示匹配的关键词

2. **高级筛选**
   - 支持按适用分类筛选模板
   - 可以按创建时间范围筛选
   - 支持按使用次数排序
   - 提供清空筛选条件的功能

### 10. 模板导入导出

#### 10.1 Excel模板导入

1. **打开导入界面**
   - 管理员点击页面头部的"导入"按钮
   - 系统打开Excel导入模态框
   - 显示文件选择控件和格式说明
   - 提供Excel模板文件下载链接

2. **Excel文件格式要求**
   - 系统支持.xlsx和.xls格式文件
   - Excel文件应包含以下工作表：
     * 模板基本信息：包含模板名称、描述、分类
     * 分类病症：支持的病症分类列表
     * 文本建议：文本类型的建议项目
     * 多选建议组：多选类型的建议组和选项
     * 单选建议组：单选类型的建议组和选项
     * 数值设置：数值类型的设置项目

3. **导入处理流程**
   - 管理员选择Excel文件后，系统解析文件内容
   - 验证文件格式和数据完整性
   - 显示导入预览，展示将要导入的模板信息
   - 提供冲突处理选项：自动重命名或覆盖现有模板
   - 管理员确认后执行批量导入操作

#### 10.2 模板导出功能

1. **单个模板导出**
   - 在模板预览界面提供"导出模板"按钮
   - 系统将模板数据转换为Excel格式
   - 生成包含完整配置信息的Excel文件
   - 支持下载到本地保存

2. **批量导出**
   - 支持选择多个模板进行批量导出
   - 生成包含多个模板的Excel文件
   - 每个模板占用独立的工作表
   - 保持数据格式的一致性

### 11. 模板使用统计

1. **统计数据查看**
   - 管理员可以点击模板列表中的使用次数
   - 系统跳转到模板使用统计页面（template-usage-stats.html）
   - 显示详细的使用统计信息和图表分析

2. **统计信息内容**
   - 模板总数和总使用次数
   - 平均使用次数和最近更新时间
   - 使用分布图表，显示各模板的使用情况
   - 使用排行榜，按使用次数排序显示模板

## 备选事件流

### 2a. 模板列表为空时
2a1. 系统显示空状态页面，提示"暂无模板"
2a2. 显示引导文案："点击新建按钮创建您的第一个健康指导模板"
2a3. 突出显示"新建"按钮，引导管理员创建模板
2a4. 可选择加载默认示例模板

### 2b. 模板数据加载失败时
2b1. 系统显示错误提示："模板数据加载失败，请检查网络连接"
2b2. 提供"重新加载"按钮，支持手动刷新
2b3. 如果是localStorage损坏，提供数据恢复选项
2b4. 记录错误日志，便于问题排查

### 3a. 模板创建过程中的异常情况

#### 3a1. 模板名称重复
- 系统检测到模板名称已存在时，显示错误提示
- 建议管理员修改模板名称或添加版本号
- 提供查看同名模板的快捷链接
- 支持自动生成唯一名称的建议

#### 3a2. 必填字段验证失败
- 当模板名称为空时，输入框显示红色边框
- 在字段下方显示具体的错误提示信息
- 阻止表单提交，直到所有必填字段完成
- 自动聚焦到第一个错误字段

#### 3a3. 数据保存失败
- 如果localStorage空间不足，提示清理存储空间
- 网络异常时，提供离线保存和稍后同步功能
- 显示具体的错误原因和解决建议
- 保留用户已输入的数据，避免重复填写

## 补充约束

### 功能性约束

#### 模板管理约束
- 模板名称必须唯一，长度限制为2-50个字符
- 模板描述最大长度为500个字符，支持换行和基本格式
- 每个模板最多支持100个建议项目，避免界面过于复杂
- 建议内容单项最大长度为200个字符
- 模板分类必须从预设列表中选择，或留空表示通用
- 删除操作需要二次确认，防止误删重要模板

#### 建议项目配置约束
- 文本建议必须包含有效内容，不允许空白或纯空格
- 多选建议组至少包含2个选项，最多支持20个选项
- 多选建议的最小选择数不能大于选项总数
- 单选建议组至少包含2个选项，必须设置默认选项
- 数值设置的最小值必须小于最大值
- 数值设置的默认值必须在设置的范围内
- 所有建议项目必须有唯一的标识符

#### 数据存储约束
- 模板数据使用JSON格式存储，确保数据结构完整性
- 每个模板包含创建时间和更新时间戳
- 模板ID使用UUID格式，确保全局唯一性
- 使用次数统计必须为非负整数
- 模板状态包括活跃、停用、已删除等状态
- 支持数据版本控制，记录模板的修改历史

### 非功能性约束

#### 性能约束
- 模板列表页面初始加载时间不超过2秒
- 模板创建和编辑操作响应时间不超过1秒
- 搜索功能响应时间不超过500毫秒
- 模板预览加载时间不超过1秒
- Excel导入处理时间不超过30秒（50个模板）
- 页面切换动画时长控制在300毫秒以内
- 支持1000个模板的并发管理，不影响系统性能

#### 用户体验约束
- 界面采用响应式设计，支持1024px-1920px屏幕分辨率
- 所有交互操作必须有即时的视觉反馈
- 表单验证错误信息清晰明确，提供解决建议
- 模态框和弹窗支持键盘操作（ESC关闭、Tab切换）
- 长时间操作提供进度指示器
- 支持撤销和重做操作，提高操作容错性
- 界面文字大小和对比度符合可访问性标准

#### 兼容性约束
- 支持Chrome 70+、Firefox 65+、Safari 12+、Edge 79+浏览器
- 兼容Windows 10、macOS 10.14+、Ubuntu 18.04+操作系统
- 支持触摸屏设备的操作，优化移动端体验
- JavaScript ES6+语法兼容性处理
- CSS3特性的优雅降级处理
- 支持高分辨率显示屏（Retina、4K等）

## 待解决问题

1. **模板版本管理**：
   - 是否需要实现模板的版本控制系统，支持版本回滚和比较？
   - 如何处理模板升级对现有医生使用的影响？
   - 版本历史的存储策略和清理机制如何设计？

2. **模板协作编辑**：
   - 是否需要支持多个管理员协作编辑同一个模板？
   - 如何实现实时协作和冲突解决机制？
   - 协作过程中的权限控制和审批流程如何设计？

3. **模板智能推荐**：
   - 是否需要基于使用统计数据提供模板优化建议？
   - 如何实现基于疾病特征的模板智能匹配？
   - 是否需要机器学习算法来优化模板内容？

4. **国际化和本地化**：
   - 是否需要支持多语言版本的健康指导模板？
   - 如何处理不同地区的医疗标准和用药差异？
   - 模板内容的翻译和本地化流程如何设计？

5. **模板质量控制**：
   - 是否需要建立模板内容的医学审核机制？
   - 如何确保模板内容的医学准确性和时效性？
   - 是否需要专业医生参与模板的审核和验证？

## 相关图

### 模板管理流程图
```
管理员登录 → 进入模板管理页面 → 查看模板列表
    ↓
选择操作：新建模板 → 填写基本信息 → 配置建议项目 → 保存模板
         编辑模板 → 修改配置 → 更新保存
         删除模板 → 确认删除 → 更新列表
         导入模板 → 选择文件 → 验证数据 → 批量导入
         查看统计 → 统计分析页面
```

### 建议项目配置流程图
```
选择建议类型（文本/多选/单选/数值）
    ↓
文本建议：输入建议内容 → 设置默认选中 → 保存
多选建议：创建选项组 → 添加选项 → 设置选择限制 → 保存
单选建议：创建选项组 → 添加选项 → 设置默认选项 → 保存
数值设置：设置参数名 → 配置数值范围 → 设置默认值 → 保存
```

### 数据流图
```
管理员操作 → [创建/编辑] → 模板管理系统 → [验证] → 数据存储
                                    ↓
医生端使用 ← [获取] ← 模板服务 ← [读取] ← 数据存储
    ↓
患者接收指导 ← [生成] ← 健康指导服务 ← [使用] ← 模板内容
```

这个用例文档详细描述了管理后台"管理健康指导模板"功能的完整流程，包括模板的创建、编辑、删除、导入导出、统计分析等核心功能，以及建议项目的配置管理。文档结合了项目的实际实现，为开发团队提供了全面的功能规范和实现指导。